#!/bin/bash

echo '[INFO] Instalando dependências ...'
dnf -q -y install pcre-devel.x86_64 expat-devel.x86_64

echo '[INFO] Baixando softwares necessários...'

wget -q https://dlcdn.apache.org//apr/apr-1.7.4.tar.gz
wget -q https://dlcdn.apache.org//apr/apr-util-1.6.3.tar.gz
wget -q https://archive.apache.org/dist/httpd/httpd-2.4.49.tar.gz

tar zxf httpd-2.4.49.tar.gz

tar zxf apr-1.7.4.tar.gz
mv apr-1.7.4 httpd-2.4.49/srclib/apr

tar zxf apr-util-1.6.3.tar.gz 
mv apr-util-1.6.3 httpd-2.4.49/srclib/apr-util

echo '[INFO] Iniciando a compilação e instalação do Apache ...'
sleep 2s

cd httpd-2.4.49/

./configure --prefix=/usr/local/httpd-2.4.49 \
            --exec-prefix=/usr/local/httpd-2.4.49 \
            --with-included-apr

make install

cd ..

echo -e '\n\n[INFO] Copiando configurações vulneráveis ...'
mv -f httpd-vulneravel.conf /usr/local/httpd-2.4.49/conf/httpd.conf

echo '[INFO] Iniciando o Servidor WEB Apache ...'
/usr/local/httpd-2.4.49/bin/apachectl start